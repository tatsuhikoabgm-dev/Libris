<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tsd.libris.mapper.shelf.ShelfMapper">


	<resultMap type="UserBooksWithBooksEntity" id="UserBooksWithBooksMap">
	
		<association property="userBooks" javaType="UserBooksEntity">
			<result property="id" column="ub_id"/>
		</association>
	
		<association property="books" javaType="BooksEntity">
			<result property="id" column="b_id"/>
			<result property="thumbnailLink" column="b_thumbnail_link"/>
		</association>
		
	</resultMap>



	<select id="findShelfBooksByUserId" resultType="UserBooksWithBooksEntity">
	
		select ub.id as ub_id,b.id as b_id,b.thumbnail_link as thumbnail_link
		from user_books ub
		join books b
		on ub.book_id = b.id
		where ub.user_id = #{userId}
		order by  ub.updated_at desc;
	
	</select>

	<select id="findShelfBooksByUserIdAndStatus" resultType="UserBooksWithBooksEntity">
	
		select ub.id as ub_id,b.id as b_id,b.thumbnail_link as thumbnail_link
		from user_books ub
		join books b
		on ub.book_id = b.id
		where ub.user_id = #{userId}
		and ub.status = #{status}
		order by  ub.updated_at desc;
	
	</select>


</mapper>