<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<title>マイページの編集 | Libris</title>

	<link rel="stylesheet" th:href="@{/css/base.css}">
	<link rel="stylesheet" th:href="@{/css/nav.css}">
	<link rel="stylesheet" th:href="@{/css/mypage.css}">
	<link rel="stylesheet" th:href="@{/css/mypage-edit.css}">

</head>

<body>

	<div th:replace="layout/fragments/nav :: nav"></div>


	<div class="wrapper">
		<div class="page-title">マイページの編集</div>
		<div class="page-sub">編集不可の項目は表示のみとなります。</div>

		<div class="card">
			<div class="section-title">会員情報</div>

			<form id="mypage-edit-form" th:action="@{/mypage/edit/confirm}" th:object="${mypageEditForm}" method="post">

				<!-- グローバルエラー -->
				<div class="field-error" th:if="${#fields.hasGlobalErrors()}" th:each="e : ${#fields.globalErrors()}"
					th:text="${e}">エラー</div>

				<div class="grid">

					<!-- ===== 編集不可項目 ===== -->
					<div class="item">
						<div class="label">姓</div>
						<input class="input" th:value="*{lastName}" disabled>
						<input type="hidden" th:field="*{lastName}">
					</div>

					<div class="item">
						<div class="label">名</div>
						<input class="input" th:value="*{firstName}" disabled>
						<input type="hidden" th:field="*{firstName}">
					</div>

					<div class="item">
						<div class="label">姓（カナ）</div>
						<input class="input" th:value="*{lastNameKana}" disabled>
						<input type="hidden" th:field="*{lastNameKana}">
					</div>

					<div class="item">
						<div class="label">名（カナ）</div>
						<input class="input" th:value="*{firstNameKana}" disabled>
						<input type="hidden" th:field="*{firstNameKana}">
					</div>

					<div class="item wide">
						<div class="label">生年月日</div>
						<input class="input" th:value="*{birthday}" disabled>
						<input type="hidden" th:field="*{birthday}">
					</div>

					<!-- ===== 編集可能項目 ===== -->
					<div class="item">
						<div class="label">郵便番号 <span class="req">必須</span></div>
						<input class="input" th:field="*{postalCode}"
							th:classappend="${#fields.hasErrors('postalCode')} ? ' is-error'">
						<div class="field-error" th:errors="*{postalCode}"></div>
					</div>

					<div class="item">
						<div class="label">都道府県 <span class="req">必須</span></div>
						<input class="input" th:field="*{prefecture}">
						<div class="field-error" th:errors="*{prefecture}"></div>
					</div>

					<div class="item">
						<div class="label">市区町村 <span class="req">必須</span></div>
						<input class="input" th:field="*{city}">
						<div class="field-error" th:errors="*{city}"></div>
					</div>

					<div class="item">
						<div class="label">町名 <span class="req">必須</span></div>
						<input class="input" th:field="*{town}">
						<div class="field-error" th:errors="*{town}"></div>
					</div>

					<div class="item">
						<div class="label">番地 <span class="req">必須</span></div>
						<input class="input" th:field="*{addressNumber}">
						<div class="field-error" th:errors="*{addressNumber}"></div>
					</div>

					<div class="item">
						<div class="label">建物名 <span class="req">必須</span></div>
						<input class="input" th:field="*{building}">
						<div class="field-error" th:errors="*{building}"></div>
					</div>

					<div class="item">
						<div class="label">電話番号 <span class="req">必須</span></div>
						<input class="input" th:field="*{phoneNumber}">
						<div class="field-error" th:errors="*{phoneNumber}"></div>
					</div>

					<div class="item">
						<div class="label">表示名</div>
						<input class="input" th:field="*{displayName}">
						<div class="field-error" th:errors="*{displayName}"></div>
					</div>

					<div class="item">
						<div class="label">メール <span class="req">必須</span></div>
						<input class="input" th:field="*{email}">
						<div class="field-error" th:errors="*{email}"></div>
					</div>

					<div class="item">
						<div class="label">メール（確認） <span class="req">必須</span></div>
						<input class="input" th:field="*{emailConfirm}">
						<div class="field-error" th:if="${!#fields.hasErrors('email')}" th:errors="*{emailConfirm}">
						</div>
					</div>

				</div>

				<div class="actions">
					<a href="/mypage" class="btn btn-secondary">戻る</a>
					<button type="submit" class="btn btn-primary" id="submitBtn" disabled>変更を確認</button>
				</div>

				<div class="footer">© 2025 Libris / たつひこシステム開発（TSD）✨</div>

			</form>
		</div>
	</div>

	<script>
	document.addEventListener('DOMContentLoaded', () => {

	  const form = document.getElementById('mypage-edit-form');
	  const submitBtn = document.getElementById('submitBtn');

	  // 編集可能な input だけ対象
	  const inputs = form.querySelectorAll(
	    'input:not([disabled]):not([type="hidden"])'
	  );

	  // 初期値を保存
	  const initialValues = {};
	  inputs.forEach(input => {
	    initialValues[input.name] = input.value;
	  });

	  const checkChanged = () => {
	    const changed = Array.from(inputs).some(input => {
	      return input.value !== initialValues[input.name];
	    });

	    submitBtn.disabled = !changed;
	  };

	  // 入力・変更を監視
	  inputs.forEach(input => {
	    input.addEventListener('input', checkChanged);
	    input.addEventListener('change', checkChanged);
	  });

	});
	</script>

	
</body>

</html>