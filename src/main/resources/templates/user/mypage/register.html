<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<title>マイページ登録 | Libris</title>
	
	<link rel="stylesheet" th:href="@{/css/base.css}">
	<link rel="stylesheet" th:href="@{/css/nav.css}">
	<link rel="stylesheet" th:href="@{/css/mypage.css}">
	<link rel="stylesheet" th:href="@{/css/mypage-register.css}">
	<link rel="stylesheet" th:href="@{/css/footer.css}">
</head>

<body>
	
	<div th:replace="layout/fragments/nav :: nav"></div>


	<div class="wrapper">

		<div class="page-title">マイページ登録</div>
		<div class="page-sub">
			会員情報の登録・表示名やメールアドレスの変更ができます。
		</div>

		<div class="message-success" th:if="${successMessage}">
			<strong th:text="${successMessage}"></strong>
		</div>

		<!-- ================== カード① マイページ登録 ================== -->
		<div class="card">
			<div class="section-title">マイページ登録（初回）</div>
			<div class="note">
				※ 住所・氏名などの会員情報を登録します。<br>
			</div>

			<form th:action="@{/mypage/register/confirm}" th:object="${mypageRegisterForm}" method="post">
				<input type="hidden" name="registerType" value="PROFILE" />


				<div class="form-grid">

					<div class="form-item">
						<label>姓</label>
						<input th:field="*{lastName}" />
						<div class="error" th:errors="*{lastName}"></div>
					</div>

					<div class="form-item">
						<label>名</label>
						<input th:field="*{firstName}" />
						<div class="error" th:errors="*{firstName}"></div>
					</div>

					<div class="form-item">
						<label>姓（カナ）</label>
						<input th:field="*{lastNameKana}" />
						<div class="error" th:errors="*{lastNameKana}"></div>
					</div>

					<div class="form-item">
						<label>名（カナ）</label>
						<input th:field="*{firstNameKana}" />
						<div class="error" th:errors="*{firstNameKana}"></div>
					</div>

					<div class="form-item">
						<label>郵便番号</label>
						<input th:field="*{postalCode}" />
						<div class="error" th:errors="*{postalCode}"></div>
					</div>

					<div class="form-item">
						<label>都道府県</label>
						<input th:field="*{prefecture}" />
						<div class="error" th:errors="*{prefecture}"></div>
					</div>

					<div class="form-item">
						<label>市区町村</label>
						<input th:field="*{city}" />
						<div class="error" th:errors="*{city}"></div>
					</div>

					<div class="form-item">
						<label>町名・番地</label>
						<input th:field="*{town}" />
						<div class="error" th:errors="*{town}"></div>
					</div>

					<div class="form-item">
						<label>番地以降</label>
						<input th:field="*{addressNumber}" />
						<div class="error" th:errors="*{addressNumber}"></div>
					</div>

					<div class="form-item">
						<label>建物名</label>
						<input th:field="*{building}" />
					</div>

					<div class="form-item">
						<label>生年月日</label>
						<input type="date" th:field="*{birthday}" />
						<div class="error" th:errors="*{birthday}"></div>
					</div>

					<div class="form-item">
						<label>電話番号</label>
						<input th:field="*{phoneNumber}" />
						<div class="error" th:errors="*{phoneNumber}"></div>
					</div>

				</div>

				<div class="register-actions">
					<button type="submit" class="btn btn-primary">登録内容を確認</button>
				</div>

			</form>
		</div>

		<!-- ================== カード② 表示名・メール変更 ================== -->
		<div class="card">
			<div class="section-title">表示名・メールアドレスの変更</div>
			<div class="note">
			</div>

			<form th:action="@{/mypage/register/confirm}" th:object="${mypageRegisterForm}" method="post" id="accountForm">
				<input type="hidden" name="registerType" value="ACCOUNT" />


				<div class="form-grid">

					<div class="form-item wide">
						<label>表示名</label>
						<input th:field="*{displayName}" />
						<div class="error" th:errors="*{displayName}"></div>
					</div>

					<div class="form-item">
						<label>メールアドレス</label>
						<input th:field="*{email}" />
						<div class="error" th:errors="*{email}"></div>
					</div>

					<div class="form-item">
						<label>メールアドレス（確認）</label>
						<input th:field="*{emailConfirm}" />
						<div class="error" th:errors="*{emailConfirm}"></div>
					</div>

				</div>

				<div class="actions">
					<button type="submit" class="btn btn-primary" id="accountSubmitBtn" disabled>変更内容を確認</button>
				</div>
			</form>
			<div class="actions password-action">
				<form th:action="@{/mypage/password}" method="get">
					<input type="hidden" name="returnTo" value="register" />
					<button type="submit" class="btn btn-outline">
						パスワード変更
					</button>
				</form>
			</div>
		</div>

	</div>
	
	<div th:replace="layout/fragments/footer :: footer"></div>
	
	<script>
	  document.addEventListener('DOMContentLoaded', () => {
	    const form = document.getElementById('accountForm');
	    const submitBtn = document.getElementById('accountSubmitBtn');

	    // 初期値を保存
	    const initialValues = Array.from(form.elements)
	      .filter(el => el.tagName === 'INPUT')
	      .map(el => el.value);

	    form.addEventListener('input', () => {
	      const currentValues = Array.from(form.elements)
	        .filter(el => el.tagName === 'INPUT')
	        .map(el => el.value);

	      const isChanged = currentValues.some(
	        (val, idx) => val !== initialValues[idx]
	      );

	      submitBtn.disabled = !isChanged;
	    });
	  });
	</script>

</body>

</html>